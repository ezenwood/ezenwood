<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="onetoone">
	
<!-- 관리자OTO리스트 -->
<select id="selectAdminoto" parameterType="hashmap" resultType="hashmap">
<![CDATA[

select
ONETOONE_DATE,
ONETOONE_TITLE,
ONETOONE_MEMBER_NUM,
ONETOONE_RE_GB
FROM ONETOONE
WHERE ONETOONE_DEL_GB = 'N'

]]>
</select>

<!-- 관리자 OTO상세페이지 -->
<select id="selectAdminDetail" parameterType="hashmap" resultType="hashmap">
<![CDATA[

select 
ONETOONE_NUM,
ONETOONE_TITLE,
ONETOONE_MEMBER_NUM,
ONETOONE_CONTENT,
ONETOONE_DATE,
MEMBER_PHONE
from ONETOONE inner join member on MEMBER_NUM = ONETOONE_MEMBER_NUM
where ONETOONE_MEMBER_NUM =
(SELECT MEMBER_NUM 
FROM MEMBER 
WHERE member_id = #{member_id})

]]>
</select>

<!-- 관리자OTO검색 -->
<select id="selectAdminSearch" parameterType="hashmap" resultType="hashmap">
<![CDATA[

select
ONETOONE_DATE,
ONETOONE_TITLE,
ONETOONE_MEMBER_NUM,
ONETOONE_RE_GB
from onetoonE
WHERE (onetoone_member_num LIKE '%'\\#{onetoone_member_num}\\'%' 
OR onetoone_TITLE LIKE '%'\\#{onetoone_TITLE}\\'%'
)


]]>
</select>

<!-- 고객OTO본인꺼만 확인 -->
<select id="selectClientMine" parameterType="hashmap" resultType="hashmap">
<![CDATA[

select 
ONETOONE_NUM,
ONETOONE_TITLE,
ONETOONE_MEMBER_NUM,
ONETOONE_CONTENT,
ONETOONE_DATE
from ONETOONE
where ONETOONE_MEMBER_NUM =#{ONETOONE_MEMBER_NUM};\

]]>
</select>

<!-- 고객 상세페이지 -->
<select id="selectClientDetail" parameterType="hashmap" resultType="hashmap">
<![CDATA[

select 
ONETOONE_NUM,
ONETOONE_TITLE,
ONETOONE_MEMBER_NUM,
ONETOONE_CONTENT,
ONETOONE_DATE,
MEMBER_PHONE
from ONETOONE inner join member on MEMBER_NUM = ONETOONE_MEMBER_NUM
where ONETOONE_MEMBER_NUM =
(SELECT MEMBER_NUM 
FROM MEMBER 
WHERE member_id = #{member_id})

]]>
</select>

<!-- 고객 OTO 작성 -->
<insert id="insertClient" parameterType="hashmap">
<![CDATA[

INSERT INTO ONETOONE(
    ONETOONE_NUM,
    ONETOONE_MEMBER_NUM,
    ONETOONE_TITLE,
    ONETOONE_CONTENT,
    ONETOONE_DATE,
    ONETOONE_DEL_GB,
    ONETOONE_TYPE)
    VALUES(
    SEQ_ONETOONE_NUM.NEXTVAL,
    (SELECT MEMBER_NUM FROM MEMBER WHERE MEMBER_ID = #{MEMBER_ID}),
    #{ONETOONE_TITLE},
    #{ONETOONE_CONTENT},
    #{ONETOONE_DATE},
    #{ONETOONE_DEL_GB},
    #{ONETOONE_TYPE})

]]>
</insert>


<!-- 관리자 OTO 작성 -->
<insert id="insertAdmin" parameterType="hashmap">
<![CDATA[

INSERT INTO ONETOONE(
    ONETOONE_NUM,
    ONETOONE_MEMBER_NUM,
    ONETOONE_TITLE,
    ONETOONE_CONTENT,
    ONETOONE_DATE,
    ONETOONE_DEL_GB,
    ONETOONE_TYPE,
    ONETOONE_PARENT)
    VALUES(
    SEQ_ONETOONE_NUM.NEXTVAL,
    (SELECT MEMBER_NUM FROM MEMBER WHERE MEMBER_ID = #{MEMBER_ID}),
    #{ONETOONE_TITLE},
    #{ONETOONE_CONTENT},
    #{ONETOONE_DATE},
    #{ONETOONE_DEL_GB},
    #{ONETOONE_TYPE},
    #{ONETOONE_PARENT});

]]>
</insert>


<!-- 관리자/고객 OTO수정 -->
<update id="updateAdmin" parameterType="hashmap">
<![CDATA[

	UPDATE ONETOONE
SET
ONETOONE_TITLE = #{ONETOONE_TITLE},
ONETOONE_CONTENT = #{ONETOONE_CONTENT}
WHERE ONETOONE_MEMBER_NUM = (SELECT MEMBER_NUM FROM MEMBER WHERE MEMBER_ID = #{MEMBER_ID})

]]>
</update>


<!-- 관리자/ 고객 OTO삭제 -->
<update id="deleteAdmin" parameterType="hashmap">
<![CDATA[

UPDATE ONETOONE
SET ONETOONE_DEL_GB = 'Y'
WHERE ONETOONE_MEMBER_NUM = (SELECT MEMBER_NUM FROM MEMBER WHERE MEMBER_ID = #{MEMBER_ID})

]]>
</update>

	
</mapper>